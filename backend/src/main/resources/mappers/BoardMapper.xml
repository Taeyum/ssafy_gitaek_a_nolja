<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.gitaek.mapper.BoardMapper">

	<select id="selectList" resultType="com.ssafy.gitaek.dto.BoardDto">
		SELECT b.board_id AS boardId,
		       b.title,
		       b.hit,
		       b.like_count AS likeCount, 
		       DATE_FORMAT(b.created_at, '%Y-%m-%d') AS createdAt,
		       u.nickname AS writerName,
		       b.user_id AS userId,
		       
		       (SELECT COUNT(*) 
		          FROM Board_Like bl 
		         WHERE bl.board_id = b.board_id 
		           AND bl.user_id = #{userId}) AS isLiked
		           
		  FROM Board b
		  JOIN Users u ON b.user_id = u.user_id
		 ORDER BY b.board_id DESC
	</select>
	
	<select id="selectOne"
		resultType="com.ssafy.gitaek.dto.BoardDto">
		SELECT b.board_id AS boardId,
		b.title,
		b.content,
		b.hit,
		b.like_count AS likeCount, DATE_FORMAT(b.created_at, '%Y-%m-%d %H:%i')
		AS
		createdAt,
		u.nickname AS writerName,
		b.user_id AS userId
		FROM Board b
		JOIN Users u ON b.user_id = u.user_id
		WHERE b.board_id = #{boardId}
	</select>

	<insert id="insertBoard">
		INSERT INTO Board (user_id, title, content,
		created_at)
		VALUES (#{userId}, #{title}, #{content}, NOW())
	</insert>

	<update id="updateBoard">
		UPDATE Board
		SET title = #{title}, content =
		#{content}
		WHERE board_id = #{boardId}
	</update>

	<delete id="deleteBoard">
		DELETE FROM Board WHERE board_id = #{boardId}
	</delete>

	<update id="updateHit">
		UPDATE Board SET hit = hit + 1 WHERE board_id =
		#{boardId}
	</update>



	<select id="checkLike" resultType="int">
		SELECT COUNT(*) FROM
		Board_Like WHERE board_id = #{boardId} AND user_id =
		#{userId}
	</select>

	<insert id="insertLike">
		INSERT INTO Board_Like (board_id, user_id) VALUES
		(#{boardId}, #{userId})
	</insert>

	<delete id="deleteLike">
		DELETE FROM Board_Like WHERE board_id = #{boardId}
		AND user_id = #{userId}
	</delete>

	<update id="updateLikeCount">
		UPDATE Board SET like_count = like_count + #{count}
		WHERE board_id =
		#{boardId}
	</update>
</mapper>