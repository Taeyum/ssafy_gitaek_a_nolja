<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¸°íƒ ì•„ë†€ì (RESTful Ver)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f4f4f9; display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .card { background: white; width: 320px; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); height: fit-content; }
        h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; margin-top: 10px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; }
        .btn-blue { background-color: #007bff; }
        .btn-green { background-color: #28a745; }
        .btn-red { background-color: #dc3545; }
        .btn-info { background-color: #17a2b8; }
        .btn-gray { background-color: #6c757d; }
        .result { margin-top: 10px; padding: 10px; background: #e9ecef; border-radius: 5px; font-size: 0.9em; min-height: 20px; word-break: break-all; }
        label { font-size: 0.9em; color: #555; }
    </style>
</head>
<body>

    <div class="card">
        <h3>ğŸ‘¶ 1. íšŒì›ê°€ì…</h3>
        <input type="text" id="joinEmail" placeholder="ì´ë©”ì¼">
        <input type="password" id="joinPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <input type="text" id="joinNick" placeholder="ë‹‰ë„¤ì„">
        <button class="btn-blue" onclick="doSignup()">ê°€ì…í•˜ê¸° (POST)</button>
        <div id="joinResult" class="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="card">
        <h3>ğŸ”‘ 2. ë¡œê·¸ì¸</h3>
        <input type="text" id="loginEmail" placeholder="ì´ë©”ì¼">
        <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <div style="margin-top:5px;"><input type="checkbox" id="rememberId" style="width:auto;"> <label for="rememberId">ì•„ì´ë”” ê¸°ì–µí•˜ê¸°</label></div>
        <button class="btn-green" onclick="doLogin()">ë¡œê·¸ì¸í•˜ê¸° (POST)</button>
        <div id="loginResult" class="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="card">
        <h3>ğŸ›¡ï¸ 3. ë‚´ ì •ë³´ (ì„¸ì…˜)</h3>
        <button class="btn-info" onclick="getMyInfo()">ğŸ“‘ ì •ë³´ ì¡°íšŒ (GET /me)</button>
        <button class="btn-red" onclick="doLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ (POST)</button>
        <div id="sessionResult" class="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="card">
        <h3>â“ 4. ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h3>
        <input type="text" id="findEmail" placeholder="ì´ë©”ì¼">
        <input type="text" id="findNick" placeholder="ë‹‰ë„¤ì„">
        <button class="btn-gray" onclick="findPw()">ì„ì‹œ ë¹„ë²ˆ ë°œê¸‰</button>
        <div id="findResult" class="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="card">
        <h3>ğŸ”’ 5. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
        <input type="password" id="currPw" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
        <input type="password" id="newPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
        <button class="btn-info" onclick="changePw()">ë³€ê²½í•˜ê¸° (PUT)</button>
        <div id="changePwResult" class="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <script>
        window.onload = function() {
            const rememberEmail = getCookie("rememberEmail");
            if (rememberEmail) {
                document.getElementById("loginEmail").value = rememberEmail;
                document.getElementById("rememberId").checked = true;
            }
        }
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // [1] íšŒì›ê°€ì…
        async function doSignup() {
            const data = {
                email: document.getElementById('joinEmail').value,
                password: document.getElementById('joinPw').value,
                nickname: document.getElementById('joinNick').value
            };
            callApi('/api/users', 'POST', data, 'joinResult');
        }

        // [2] ë¡œê·¸ì¸
        async function doLogin() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPw').value,
                rememberId: document.getElementById('rememberId').checked
            };
            await callApi('/api/users/login', 'POST', data, 'loginResult');
            // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì¿ í‚¤ í™•ì¸ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨ (1.5ì´ˆ ë’¤)
            setTimeout(() => location.reload(), 1500);
        }

        // [3] ë‚´ ì •ë³´ ì¡°íšŒ
        async function getMyInfo() {
            callApi('/api/users/me', 'GET', null, 'sessionResult');
        }

        // [3-2] ë¡œê·¸ì•„ì›ƒ
        async function doLogout() {
            callApi('/api/users/logout', 'POST', null, 'sessionResult');
        }

        // [4] ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
        async function findPw() {
            const data = {
                email: document.getElementById('findEmail').value,
                nickname: document.getElementById('findNick').value
            };
            callApi('/api/users/password-recovery', 'POST', data, 'findResult');
        }

        // [5] ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        async function changePw() {
            const data = {
                currentPassword: document.getElementById('currPw').value,
                newPassword: document.getElementById('newPw').value
            };
            callApi('/api/users/password', 'PUT', data, 'changePwResult');
        }

        // ê³µí†µ API í•¨ìˆ˜
        async function callApi(url, method, data, resultId) {
            const resultDiv = document.getElementById(resultId);
            const options = { method: method, headers: { 'Content-Type': 'application/json' } };
            if (data) options.body = JSON.stringify(data);

            try {
                const response = await fetch(url, options);
                const text = await response.text();
                if (response.ok) {
                    try {
                        const json = JSON.parse(text);
                        resultDiv.innerHTML = `<span style="color:green; font-weight:bold;">âœ… ì„±ê³µ</span><br><pre>${JSON.stringify(json, null, 2)}</pre>`;
                    } catch(e) {
                        resultDiv.innerHTML = `<span style="color:green; font-weight:bold;">âœ… ${text}</span>`;
                    }
                } else {
                    resultDiv.innerHTML = `<span style="color:red; font-weight:bold;">ğŸ’¥ ì‹¤íŒ¨ (${response.status})</span><br>${text}`;
                }
            } catch (error) {
                console.error(error);
                resultDiv.innerHTML = '<span style="color:red;">âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</span>';
            }
        }
    </script>
</body>
</html>